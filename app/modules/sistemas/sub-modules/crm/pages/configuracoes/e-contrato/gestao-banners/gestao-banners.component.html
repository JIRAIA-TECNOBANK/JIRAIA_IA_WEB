<div class="px-2 pb-3">
  <div [hidden]="childstate">
    <section class="box__btn">
      <button
        mat-flat-button
        color="secondary"
        class="box__btn--btn"
        (click)="incluirBanner()"
        [id]="utility.getElementId(2, 'banner-incluir')"
        [disabled]="
          !utility.getPermission([Permissoes.GESTAO_COMUNICADOS_CADASTRAR])
        "
      >
        Incluir banner
      </button>
    </section>

    <div>
      <app-grid-filter
        [filter]="filter"
        (pesquisar)="search($event)"
        (redefinir)="redefinir()"
        [showRedefinir]="showRedefinirBtn"
        (customControls)="setCustomControls($event)"
      >
        <app-filter-field
          [field]="fieldBannerTitulo"
          [control]="bannerIdControl"
          [searchControl]="bannerSearchControl"
          (searchInput)="searchFilter($event)"
          [redefinirField]="refreshGrid"
        >
        </app-filter-field>

        <app-filter-field
          [field]="fieldTipoBanner"
          [control]="tipoBannerControl"
        >
        </app-filter-field>

        <!--Periodo-->
        <button
          mat-stroked-button
          [matMenuTriggerFor]="menuRadio"
          class="filter-button mt-2"
          [id]="utility.getElementId(2, 'filter', fieldPeriodo.id)"
          type="button"
          [ngClass]="{
            'filter-active':
              (periodoControl.value ||
                dataInicialControl.value ||
                dataFinalControl.value) &&
              !dataInicialControl.invalid &&
              !dataFinalControl.invalid,
            'filter-error':
              dataInicialControl.invalid || dataFinalControl.invalid
          }"
          fxFlex
        >
          <span class="filter-title">{{ fieldPeriodo.titulo }}</span>
          <i class="fal fa-chevron-down mr-1"></i>
        </button>
        <mat-menu #menuRadio="matMenu" class="mat-elevation-z8 filter">
          <div class="filter-search" (click)="stopPropagation($event)">
            <div
              class="filter-header d-flex justify-content-between pl-2 b-divider"
            >
              <span> Por período</span>
              <button
                [id]="utility.getElementId(2, 'filter-clean', fieldPeriodo.id)"
                mat-button
                color="primary"
                class="btn-redefinir"
                (click)="redefinirFilterField(periodoControl, fieldPeriodo)"
              >
                Limpar
              </button>
            </div>

            <section class="filter-options py-1 px-2">
              <mat-radio-group
                [formControl]="periodoControl"
                [id]="utility.getElementId(3, 'filter', fieldPeriodo.id)"
              >
                <mat-radio-button
                  *ngFor="let option of fieldPeriodo.options"
                  [value]="option.value"
                  class="mb-1"
                  (change)="cleanDates()"
                >
                  {{ option.label }}</mat-radio-button
                >
              </mat-radio-group>

              <div class="row pt-1" fxLayoutGap="10">
                <mat-form-field
                  appearance="outline"
                  fxFlex="50"
                  class="mat-field-small mr-1"
                >
                  <mat-label>DE</mat-label>
                  <input
                    [id]="utility.getElementId(6, 'filter-de', fieldPeriodo.id)"
                    [formControl]="dataInicialControl"
                    matInput
                    placeholder="dd/mm/aaaa"
                    (keydown.tab)="
                      $event.stopPropagation(); de.close(); ate.open()
                    "
                    (dateChange)="onChangePeriodo($event.target.value, true)"
                    [min]="minInitialDate"
                    [matDatepicker]="de"
                    [required]="
                      dataFinalControl.value != null &&
                      dataFinalControl.value != ''
                    "
                    (click)="de.open()"
                  />
                  <mat-datepicker-toggle matSuffix [for]="de" hidden>
                  </mat-datepicker-toggle>
                  <mat-datepicker #de></mat-datepicker>
                  <mat-hint
                    class="text-danger bold"
                    *ngIf="dataInicialControl.hasError('required')"
                  >
                    Campo obrigatório
                  </mat-hint>
                  <mat-hint
                    class="text-danger bold"
                    *ngIf="dataInicialControl.hasError('matDatepickerMax')"
                  >
                    Data inicial não pode ser maior que hoje
                  </mat-hint>
                </mat-form-field>

                <mat-form-field
                  appearance="outline"
                  fxFlex="50"
                  class="mat-field-small"
                >
                  <mat-label>ATÉ</mat-label>
                  <input
                    [id]="
                      utility.getElementId(6, 'filter-ate', fieldPeriodo.id)
                    "
                    [formControl]="dataFinalControl"
                    matInput
                    placeholder="dd/mm/aaaa"
                    (keydown.tab)="ate.close()"
                    (dateChange)="onChangePeriodo($event.target.value, false)"
                    [min]="minDate"
                    [max]="maxDate"
                    [matDatepicker]="ate"
                    (click)="ate.open()"
                    [required]="
                      dataInicialControl.value != null &&
                      dataInicialControl.value != ''
                    "
                  />
                  <mat-datepicker-toggle matSuffix [for]="ate" hidden>
                  </mat-datepicker-toggle>
                  <mat-datepicker #ate></mat-datepicker>
                  <mat-error
                    class="text-danger bold"
                    *ngIf="
                      erroDataFinal ||
                      dataFinalControl.hasError('matDatepickerMin')
                    "
                  >
                    Data final deve ser maior que a data inicial
                  </mat-error>
                  <mat-hint
                    class="text-danger bold"
                    *ngIf="dataFinalControl.hasError('required')"
                  >
                    Campo obrigatório
                  </mat-hint>
                  <mat-hint
                    class="text-danger bold"
                    *ngIf="dataFinalControl.hasError('matDatepickerMax')"
                  >
                    Data final não pode ser maior que hoje
                  </mat-hint>
                </mat-form-field>
              </div>
            </section>
          </div>
        </mat-menu>
        <!--Fim Periodo-->

        <app-filter-field
          [field]="fieldStatus"
          [control]="statusControl"
          (selectAll)="selectAll($event)"
        >
        </app-filter-field>
      </app-grid-filter>

      <mat-card class="mat-elevation-z8 mt-2 p-0">
        <section class="text-paginator">
          <div class="row d-flex">
            <section class="default-text" *ngIf="paginator">
              Mostrando
              {{
                paginator?.pageSize > totalItems
                  ? totalItems
                  : paginator?.pageSize
              }}
              de {{ totalItems }} resultados
            </section>
          </div>
        </section>
        <mat-paginator
          [pageSizeOptions]="[25, 50, 75, 100]"
          [length]="totalItems"
          aria-label="Itens por página"
          #paginator
        >
        </mat-paginator>

        <div>
          <table mat-table [dataSource]="items$ | async">
            <ng-container matColumnDef="titulo">
              <th mat-header-cell *matHeaderCellDef>Título</th>
              <td mat-cell *matCellDef="let element" [title]="element.titulo">
                {{ element.titulo }}
              </td>
            </ng-container>

            <ng-container matColumnDef="tipo">
              <th mat-header-cell *matHeaderCellDef>Tipo</th>
              <td
                mat-cell
                *matCellDef="let element"
                [title]="element.tipo"
                class="column-max-width"
              >
                {{ element.tipo }}
              </td>
            </ng-container>

            <ng-container matColumnDef="dataInicio">
              <th mat-header-cell *matHeaderCellDef>Data início</th>
              <td mat-cell *matCellDef="let element">
                {{ formatDate(element.dataInicio) ?? "-" }}
              </td>
            </ng-container>

            <ng-container matColumnDef="dataFim">
              <th mat-header-cell *matHeaderCellDef>Data fim</th>
              <td mat-cell *matCellDef="let element">
                {{ formatDate(element.dataFim) ?? "-" }}
              </td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let element">
                {{ element.status }}
              </td>
            </ng-container>

            <ng-container matColumnDef="acoes">
              <th mat-header-cell *matHeaderCellDef class="min-width"></th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <button mat-button [matMenuTriggerFor]="menu">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #menu="matMenu">
                    <button
                      mat-menu-item
                      (click)="editarBanner(element.id)"
                      [id]="
                        utility.getElementId(2, 'editar-consultar', element.id)
                      "
                      [disabled]="
                        !utility.getPermission([
                          Permissoes.GESTAO_COMUNICADOS_CONSULTAR,
                          Permissoes.GESTAO_COMUNICADOS_CADASTRAR
                        ])
                      "
                    >
                      Editar/Consultar
                    </button>
                    <button
                      mat-menu-item
                      [id]="
                        utility.getElementId(2, 'ativar-inativar', element.id)
                      "
                      [disabled]="
                        !utility.getPermission([
                          Permissoes.GESTAO_COMUNICADOS_CADASTRAR
                        ])
                      "
                      (click)="
                        inativarOuAtivarBanner(
                          element.id,
                          element.status !== 'Inativo'
                        )
                      "
                    >
                      {{ element.status == "Inativo" ? "Ativar" : "Inativar" }}
                    </button>
                  </mat-menu>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="semRegistro">
              <th
                class="text-center feedBack pt-1"
                mat-cell
                *matFooterCellDef
                colspan="11"
              >
                <img
                  src="./../../../../../../../../../assets/img/custom-icons/icon-vazio-artigos.svg"
                />
                <p class="desk bold text-gray-700">Não há registros.</p>
              </th>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            <tr
              mat-row
              *matFooterRowDef="['semRegistro']"
              [ngClass]="{ 'd-none': totalItems > 0 }"
            ></tr>
          </table>
          <section class="text-paginator">
            <div class="row d-flex">
              <section class="default-text">
                Mostrando
                {{
                  paginator?.pageSize > totalItems
                    ? totalItems
                    : paginator?.pageSize
                }}
                de {{ totalItems }} resultados
              </section>
            </div>
          </section>
          <mat-paginator
            (page)="syncPrimaryPaginator($event)"
            [pageSize]="paginator.pageSize"
            [pageIndex]="paginator.pageIndex"
            [length]="paginator.length"
            [pageSizeOptions]="paginator?.pageSizeOptions"
          >
          </mat-paginator>
        </div>
      </mat-card>
    </div>
  </div>

  <router-outlet></router-outlet>
</div>
