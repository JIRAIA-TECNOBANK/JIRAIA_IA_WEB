<div [hidden]="childstate" class="px-2">
  <mat-card class="mb-4 mat-elevation-z8">
    <form [formGroup]="createGroupForm" (ngSubmit)="submitGrupoEconomicoEmpresa()" fxLayout="column">
      <div class="d-flex justify-content-between align-items-center">
        <div class="fw-bold">Dados do grupo </div>
      </div>

      <section fxLayout="column" class="mt-2">
        <div fxLayout="row" fxFlex>
          <mat-form-field appearance="outline" fxFlex="35">
            <mat-label>Nome do grupo econômico</mat-label>
            <input matInput class="input-padrao-height" placeholder="Digite o nome" formControlName="nameGroup"
              [id]="getElementId(0, 'gp-economico-nome')" />
            <mat-hint>Obrigatório</mat-hint>
            <mat-error *ngIf="createGroupForm.controls['nameGroup'].hasError('required')">Obrigatório
            </mat-error>
            <mat-error *ngIf="createGroupForm.controls['nameGroup'].hasError('minlength')">Nome deve conter ao
              menos 3 caracteres</mat-error>
          </mat-form-field>
        </div>

        <div class="d-flex justify-content-start align-items-center mt-2 mb-1">
          <div class="fw-bold">Dados de contato do Usuário Master</div> &nbsp;<i
            class="fa-regular fa-circle-info text-blue-700"
            [matTooltip]="'Sempre utilize e-mails corporativos para o usuário master. Porém, em casos específicos aonde não há possibilidade, você poderá adicionar e-mails pessoais.'"
            matTooltipClass="info-tooltip"></i>
        </div>
        <div fxLayout="row wrap" fxLayoutGap="10px grid" fxFlex>
          <div fxLayout="row" fxLayoutGap="10px" fxFlex="100">
            <mat-form-field appearance="outline" fxFlex="50">
              <mat-label>E-mail corporativo</mat-label>
              <input matInput placeholder="E-mail corporativo" type="text" formControlName="email"
                [id]="getElementId(0, 'gp-economico-master-email')" #email (blur)="verificaEmail(email.value)" />
              <mat-hint>Obrigatório</mat-hint>
              <mat-error *ngIf="createGroupForm.controls['email'].hasError('required')">Obrigatório
              </mat-error>
              <mat-error *ngIf="createGroupForm.get('email').hasError('pattern')"> E-mail inválido
              </mat-error>
              <mat-error *ngIf="createGroupForm.get('email').getError('invalidIdentifier') == 'usuarioExistente'">
                Usuário existente no sistema
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" fxFlex="50">
              <mat-label>Confirme novamente o e-mail corporativo</mat-label>
              <input matInput placeholder="Confirme novamente o e-mail corporativo" type="text" formControlName="confirmacaoEmail"
                [id]="getElementId(0, 'gp-economico-confirmacao-email')" #confirmacaoEmail (blur)="verificaConfirmacaoEmail(confirmacaoEmail.value)" />
              <mat-hint>Obrigatório</mat-hint>
              <mat-error *ngIf="createGroupForm.controls['confirmacaoEmail'].hasError('required')">Obrigatório
              </mat-error>
              <mat-error *ngIf="createGroupForm.get('confirmacaoEmail').hasError('pattern')"> E-mail inválido
              </mat-error>
              <mat-error *ngIf="createGroupForm.get('confirmacaoEmail').getError('invalidIdentifier') == 'EmailDiferente'">
                E-mail digitado não confere, favor verificar e corrigir
              </mat-error>
            </mat-form-field>
          </div>

          <div fxLayout="row wrap" fxLayoutGap="10px grid" fxFlex="100"
            *ngFor="let group of telefonesArray.controls; let i = index;" formArrayName="telefones">
            <div class="" [formGroupName]='i' fxFlex="35">
              <mat-form-field appearance="outline" fxFlex="100">
                <mat-label>Telefone corporativo</mat-label>
                <input matInput placeholder="(00) 00000-0000" formControlName="telefone"
                  mask="(00) 0000-0000 || (00) 00000-0000" [id]="getElementId(0, 'gp-economico-telefone', i)" />
                <mat-hint>Obrigatório</mat-hint>
                <mat-error *ngIf="telefonesArray.controls[i].controls['telefone'].hasError('required')">Obrigatório
                </mat-error>
              </mat-form-field>
            </div>

            <button *ngIf="telefonesArray.controls.length > 1 && i + 1 < telefonesArray.controls.length"
              class="btn-telefone remove-telefone" (click)="removeTelefone(i)"
              [id]="getElementId(2, 'gp-economico-dlt-telefone', i)" [disabled]="!emailVerificado"><i
                class="fa-solid fa-minus"></i>
              Remover esse número</button>
            <button
              *ngIf="i + 1 == telefonesArray.controls.length && utility.getPermission([Permissoes.GESTAO_EMPRESA_GRUPO_ECONOMICO_CADASTRAR])"
              class="btn-telefone add-telefone" type="button" (click)="addTelefone()"
              [id]="getElementId(2, 'gp-economico-add-telefone', i)" [disabled]="!emailVerificado"><i
                class="fa-solid fa-plus"></i> Adicionar
              outro número</button>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-2 mb-1">
          <div class="fw-bold">Dados de acesso do Usuário Master</div>
        </div>
        <div fxLayout="row" fxLayoutGap="10px" fxFlex="100">
          <mat-form-field appearance="outline" fxFlex="45">
            <mat-label>Nome</mat-label>
            <input matInput class="input-padrao-height" placeholder="Digite o nome" formControlName="nomeMaster"
              [id]="getElementId(0, 'gp-economico-master-nome')" />
            <mat-hint>Obrigatório</mat-hint>
            <mat-error *ngIf="createGroupForm.controls['nomeMaster'].hasError('required')">Obrigatório
            </mat-error>
            <mat-error *ngIf="createGroupForm.controls['nomeMaster'].hasError('minlength')">Nome deve conter ao
              menos 3 caracteres</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="35">
            <mat-label>Sobrenome</mat-label>
            <input matInput class="input-padrao-height" placeholder="Digite o sobrenome"
              formControlName="sobrenomeMaster" [id]="getElementId(0, 'gp-economico-master-sobrenome')" />
            <mat-hint>Obrigatório</mat-hint>
            <mat-error *ngIf="createGroupForm.controls['sobrenomeMaster'].hasError('required')">Obrigatório
            </mat-error>
            <mat-error *ngIf="createGroupForm.controls['sobrenomeMaster'].hasError('minlength')">Sobrenome deve conter
              ao
              menos 3 caracteres</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20" [ngClass]="{ 'd-none': anonimizar }">
            <mat-label>CPF</mat-label>
            <input matInput class="input-padrao-height" placeholder="Digite o nome" formControlName="cpfMaster"
              mask="000.000.000-00" placeholder="000.000.000-00" [id]="getElementId(0, 'gp-economico-master-cpf')" />
            <mat-hint>Obrigatório</mat-hint>
            <mat-error *ngIf="createGroupForm.controls['cpfMaster'].hasError('required')">Obrigatório
            </mat-error>
            <mat-error *ngIf="createGroupForm.get('cpfMaster').hasError('documentNotValid')">
              CPF inválido
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20" [ngClass]="{ 'd-none': !anonimizar }">
            <mat-label>CPF</mat-label>
            <input matInput class="input-padrao-height" placeholder="Digite o nome" formControlName="cpfAnonimizado"
              [id]="getElementId(0, 'gp-economico-master-cpf-anonimizado')" />
            <mat-hint>Obrigatório</mat-hint>
          </mat-form-field>
        </div>

        <div fxLayout="row" class="mt-2" fxLayoutAlign="space-between end">
          <mat-slide-toggle formControlName="enviaNotificacao">Envia notificação para usuários
            inativos</mat-slide-toggle>

          <section fxFlex="50" *ngIf="editarGrupo">
            <app-liberar-acessos (liberacaoAcesso)="liberarAcesso($event)"></app-liberar-acessos>
          </section>
        </div>

        <div fxLayout="row" class="mt-2">
          <mat-slide-toggle formControlName="ativaMfa">Ativar dupla autenticação dos usuários da empresa</mat-slide-toggle>
        </div>

        <div fxLayout="row" class="mt-2">
          <mat-slide-toggle formControlName="notificaFaturamento">Receber notificações do faturamento</mat-slide-toggle>
        </div>

        <div class="d-flex justify-content-end mt-4">
          <button mat-flat-button color="secondary" type="submit" [disabled]="desabilitaConfirmar()"
            *ngIf=" utility.getPermission([Permissoes.GESTAO_EMPRESA_GRUPO_ECONOMICO_CADASTRAR])"
            [id]="getElementId(2, 'gp-economico-confirmar')">
            Confirmar
          </button>
        </div>
      </section>
    </form>
  </mat-card>
</div>

<section [hidden]="childstate" *ngIf="createGroupForm.get('id').value">
  <app-associacao-empresa [grupoEconomicoId]="grupoEconomicoId"></app-associacao-empresa>
</section>

<div class="px-2">
  <router-outlet></router-outlet>
</div>