<mat-card class="mb-4 mat-elevation-z8">
  <div class="d-flex justify-content-between align-items-center">
    <div class="fw-bold">Dados do usuário</div>
  </div>
  <form [formGroup]="createUsuarioForm" (ngSubmit)="submitUsuario()" class="mt-2">
    <div fxLayout="row" fxLayoutGap="10px">
      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>E-mail</mat-label>
        <input matInput placeholder="E-mail" type="text" formControlName="email" required #email
          (blur)="verificaEmail(email.value)" [id]="utility.getElementId(0, 'usuario-email')" />
        <mat-error *ngIf="createUsuarioForm.controls['email'].hasError('required')">Campo obrigatório</mat-error>
        <mat-error *ngIf="createUsuarioForm.get('email').hasError('pattern')"> E-mail inválido </mat-error>
        <mat-error *ngIf="createUsuarioForm.get('email').getError('invalidIdentifier') == 'usuarioExistente'">
          Usuário existente no sistema
        </mat-error>
        <mat-error *ngIf="createUsuarioForm.get('email').getError('invalidIdentifier') == 'emailExistenteNaEmpresa'">
          E-mail já cadastrado para esta empresa
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>Confirme o e-mail</mat-label>
        <input matInput placeholder="Confirme o e-mail" type="text" formControlName="confirmacaoEmail" required
          #confirmacaoEmail (blur)="verificaConfirmacaoEmail(confirmacaoEmail.value)"
          [id]="utility.getElementId(0, 'confirmacao-usuario-email')" />
        <mat-error *ngIf="createUsuarioForm.controls['confirmacaoEmail'].hasError('required')">Campo
          obrigatório</mat-error>
        <mat-error *ngIf="createUsuarioForm.get('confirmacaoEmail').hasError('pattern')"> E-mail inválido </mat-error>
        <mat-error *ngIf="createUsuarioForm.get('confirmacaoEmail').getError('invalidIdentifier') == 'EmailDiferente'">
          E-mail digitado não confere, favor verificar e corrigir
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" fxFlex="32.5" [ngClass]="{ 'd-none': anonimizar }">
        <mat-label>CPF </mat-label>
        <input matInput placeholder="000.000.000-00" formControlName="cpf" mask="000.000.000-00" required
          [id]="utility.getElementId(0, 'usuario-cpf')" />
        <mat-error *ngIf="createUsuarioForm.controls['cpf'].hasError('required')">Campo obrigatório</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" fxFlex="32.5" [ngClass]="{ 'd-none': !anonimizar }">
        <mat-label>CPF </mat-label>
        <input matInput placeholder="000.000.000-00" formControlName="cpfAnonimizado"
          [id]="utility.getElementId(0, 'usuario-cpf')" />
      </mat-form-field>
    </div>
    <div fxLayout="row" fxLayoutGap="10px">
      <mat-form-field appearance="outline" fxFlex="33">
        <mat-label>Nome do usuário </mat-label>
        <input matInput placeholder="Nome do usuário" formControlName="nome" required
          [id]="utility.getElementId(0, 'usuario-nome')" />
        <mat-error *ngIf="createUsuarioForm.controls['nome'].hasError('required')">Campo obrigatório</mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" fxFlex="33">
        <mat-label>Sobrenome </mat-label>
        <input matInput placeholder="Sobrenome" formControlName="sobrenome" required
          [id]="utility.getElementId(0, 'usuario-sobrenome')" />
        <mat-error *ngIf="createUsuarioForm.controls['sobrenome'].hasError('required')">Campo obrigatório</mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>Telefone corporativo (fixo) </mat-label>
        <input matInput placeholder="(00) 00000-0000" formControlName="telefone" mask="(00) 0000-0000"
          [id]="utility.getElementId(0, 'usuario-telefone')" />
        <mat-error *ngIf="createUsuarioForm.controls['telefone'].hasError('required')">Campo obrigatório</mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" [style.width.px]="80">
        <mat-label>Ramal </mat-label>
        <input matInput placeholder="0000" formControlName="ramal" [id]="utility.getElementId(0, 'usuario-ramal')" />
      </mat-form-field>
    </div>
    <div fxLayout="row" fxLayoutGap="10px">
      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>Perfil </mat-label>
        <mat-select formControlName="perfil" required [id]="utility.getElementId(5, 'usuario-perfil')">
          <mat-option *ngFor="let perfil of perfis" [value]="perfil.id"
            [id]="utility.getElementId(7, 'usuario-perfil', perfil.id)">
            {{ perfil.nome }}</mat-option>
        </mat-select>
        <mat-error *ngIf="createUsuarioForm.controls['perfil'].hasError('required')">Campo obrigatório</mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>Departamento </mat-label>
        <mat-select formControlName="departamento" required [id]="utility.getElementId(5, 'usuario-departamento')">
          <mat-option> Escolha o departamento</mat-option>
          <mat-option *ngFor="let departamento of departamentos" [value]="departamento.id"
            [id]="utility.getElementId(7, 'usuario-departamento', departamento.id)">{{ departamento.nome }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="
            createUsuarioForm.controls['departamento'].hasError('required')
          ">Campo obrigatório</mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>Cargo </mat-label>
        <mat-select formControlName="cargo" required [id]="utility.getElementId(5, 'usuario-cargo')">
          <mat-option> Escolha o cargo</mat-option>
          <mat-option *ngFor="let cargo of cargos" [value]="cargo.id"
            [id]="utility.getElementId(7, 'usuario-cargo', cargo.id)">{{
            cargo.nome
            }}</mat-option>
        </mat-select>
        <mat-error *ngIf="createUsuarioForm.controls['cargo'].hasError('required')">Campo obrigatório</mat-error>
      </mat-form-field>
    </div>

    <div fxLayout="row" fxLayoutGap="10px" class="mt-2"
      *ngIf="novoDepartamento(createUsuarioForm.get('departamento').value)">
      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>Novo Departamento</mat-label>
        <input matInput placeholder="Digite o novo departamento" formControlName="novoDepartamento" required
          [id]="utility.getElementId(0, 'usuario-novo-departamento')" />
        <mat-error *ngIf="">Campo obrigatório</mat-error>
      </mat-form-field>

      <div class="btn-wrapper">
        <button mat-flat-button class="btn-adicionar" color="primary" type="button"
          [id]="utility.getElementId(2, 'usuario-add-departamento')"
          (click)="adicionarDepartamento(createUsuarioForm.get('novoDepartamento').value)"
          [disabled]="!createUsuarioForm.get('novoDepartamento').valid">Adicionar</button>
      </div>
    </div>

    <div fxLayout="row" fxLayoutGap="10px" class="mt-2" *ngIf="novoCargo(createUsuarioForm.get('cargo').value)">
      <mat-form-field appearance="outline" fxFlex="auto">
        <mat-label>Novo Cargo</mat-label>
        <input matInput placeholder="Digite o novo cargo" formControlName="novoCargo" required
          [id]="utility.getElementId(0, 'usuario-novo-cargo')" />
        <mat-error *ngIf="">Campo obrigatório</mat-error>
      </mat-form-field>

      <div class="btn-wrapper">
        <button mat-flat-button class="btn-adicionar" color="primary" type="button"
          [id]="utility.getElementId(2, 'usuario-add-cargo')"
          (click)="adicionarCargo(createUsuarioForm.get('novoCargo').value)"
          [disabled]="!createUsuarioForm.get('novoCargo').valid">Adicionar</button>
      </div>
    </div>

    <div fxLayout="row" fxLayoutGap="10px">
      <div fxFlex="20">
        <mat-slide-toggle formControlName="ativo"
          [id]="utility.getElementId(12, 'usuario-ativo')">Ativo?</mat-slide-toggle>
      </div>
      <div fxFlex="30">
        <mat-slide-toggle formControlName="recebeComunicados"
          [id]="utility.getElementId(12, 'usuario-receber-email')">Usuário receberá e-mail?</mat-slide-toggle>
      </div>

      <app-liberar-acessos *ngIf="usuarioGuid" (liberacaoAcesso)="liberarAcesso($event)"></app-liberar-acessos>
    </div>

    <div fxLayout="row" class="mt-2" *ngIf="habilitarNotificacaoFaturamento">
      <mat-slide-toggle formControlName="notificaFaturamento">Receber notificações do faturamento?</mat-slide-toggle>
    </div>

    <div class="d-flex justify-content-end mt-4">
      <button mat-flat-button color="primary" type="submit" [disabled]="desabilitaConfirmar()"
        [id]="utility.getElementId(2, 'usuario-confirmar')"
        *ngIf="utility.getPermission([Permissoes.GESTAO_EMPRESA_USUARIO_CRM_CADASTRAR])">
        Confirmar
      </button>
    </div>
  </form>
</mat-card>