<div [hidden]="childstate">
  <app-skeleton-grid [colunas]="displayedColumns" [hidden]="!loading"></app-skeleton-grid>

  <div [hidden]="loading">
    <section class="text-paginator">
      <div class="row d-flex">
        <section class="default-text" *ngIf="paginator">
          Mostrando {{ paginator?.pageSize > totalItems ? totalItems : paginator?.pageSize }} de {{
          totalItems }} resultados
        </section>
      </div>
    </section>
    <mat-paginator [pageSizeOptions]="[25, 50, 75, 100]" [length]="totalItems" #paginator></mat-paginator>

    <table mat-table multiTemplateDataRows aria-describedby="lista-registros" [dataSource]="items$ | async"
      (matSortChange)="sortData($event)" matSort>

      <ng-container matColumnDef="semRegistro">
        <th class="text-center feedBack pt-1" mat-cell *matFooterCellDef colspan="11">
          <img src="./../../../../../../../../../assets/img/custom-icons/icon-vazio-artigos.svg" />
          <p class="desk bold text-gray-700"> Não há registros. </p>
        </th>
      </ng-container>

      <ng-container matColumnDef="numeroLote">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Protocolo do lote</th>
        <td mat-cell *matCellDef="let element">{{ element.numeroLote }}</td>
      </ng-container>

      <ng-container matColumnDef="nomeEmpresa">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Empresa</th>
        <td mat-cell *matCellDef="let element">{{ element.nomeEmpresa }}</td>
      </ng-container>

      <ng-container matColumnDef="dataSolicitacao">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Data da solicitação</th>
        <td mat-cell *matCellDef="let element">
          {{ element.dataSolicitacao }}
        </td>
      </ng-container>

      <ng-container matColumnDef="dataProcessamento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Data do processamento</th>
        <td mat-cell *matCellDef="let element">
          {{ element.dataProcessamento }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td class="pl-1 pr-1" mat-cell *matCellDef="let element">
          {{ element.status }}
        </td>
      </ng-container>

      <ng-container matColumnDef="versaoArquivo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Versão do arquivo</th>
        <td mat-cell *matCellDef="let element">
          {{ element.versaoArquivo }}
        </td>
      </ng-container>

      <ng-container matColumnDef="usuario">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Usuário</th>
        <td mat-cell *matCellDef="let element">
          {{ element.usuario }}
        </td>
      </ng-container>

      <ng-container matColumnDef="tipoDoArquivo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de arquivo</th>
        <td mat-cell *matCellDef="let element">
          {{ element.tipoDoArquivo }}
        </td>
      </ng-container>

      <ng-container matColumnDef="registrados">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Registrados</th>
        <td mat-cell *matCellDef="let element">
          <span
            [ngClass]="{ 'text-danger bold': getRegistrosSucesso(element.registrados) < getRegistrosTotal(element.registrados) }">{{
            getRegistrosSucesso(element.registrados) }}</span> de {{
          getRegistrosTotal(element.registrados) }}
        </td>
      </ng-container>


      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
          <div>
            <button mat-button [matMenuTriggerFor]="menu" [id]="getElementId(2, 'acoes', element.numeroLote)">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item [id]="getElementId(2, 'visualizar-lote', element.numeroLote)"
                (click)="goToConsulta(element.numeroLote)"> Visualizar lote
              </button>
              <button mat-menu-item [id]="getElementId(2, 'baixar-arquivo-original', element.numeroLote)"
                (click)="onClickDownload(element.numeroLote)"> Baixar
                arquivo original </button>
              <button mat-menu-item [id]="getElementId(2, 'baixar-arquivo-retorno-csv', element.numeroLote)"
                (click)="onClickDownloadRetorno(element.numeroLote, 'CSV')"
                [disabled]="!utility.getPermission([Permissoes.GESTAO_OPERACOES_ARQUIVOS_RETORNO_LOTE_CONSULTAR])">
                Baixar
                arquivo de retorno CSV </button>
              <button mat-menu-item [id]="getElementId(2, 'baixar-arquivo-retorno-txt', element.numeroLote)"
                (click)="onClickDownloadRetorno(element.numeroLote, 'TXT')"
                [disabled]="!utility.getPermission([Permissoes.GESTAO_OPERACOES_ARQUIVOS_RETORNO_LOTE_CONSULTAR])">
                Baixar
                arquivo de retorno TXT </button>
            </mat-menu>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      <tr mat-row *matFooterRowDef="['semRegistro']"
        [ngClass]="{'d-none': !(totalItems == 0 || totalItems == undefined) }"></tr>
    </table>

    <section class="text-paginator">
      <div class="row d-flex">
        <section class="default-text">
          Mostrando {{ paginator?.pageSize > totalItems ? totalItems : paginator?.pageSize }} de {{
          totalItems }} resultados
        </section>
      </div>
    </section>
    <mat-paginator (page)="syncPrimaryPaginator($event)" [pageSize]="paginator?.pageSize"
      [pageIndex]="paginator?.pageIndex" [length]="paginator?.length" [pageSizeOptions]="paginator?.pageSizeOptions">
    </mat-paginator>
  </div>
</div>